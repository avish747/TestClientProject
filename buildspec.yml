version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.x
    commands:
      - echo "Starting build to upload file to S3"
      # Fetch latest changes to make sure HEAD is updated
      - git fetch --all

  pre_build:
    commands:
      - FILE="test_client_project/data/test.json"
      # Check if the file is staged or changed in this commit using git diff-index
      - if git diff-index --name-only HEAD | grep -q "$FILE"; then
          export FILE_CHANGED=true;
        else
          export FILE_CHANGED=false;
        fi

  build:
    commands:
      - if [ "$FILE_CHANGED" = true ]; then
          echo "Uploading $FILE to S3...";
          aws s3 cp $FILE s3://test-client-project/source_ip_file/test.json;
        else
          echo "$FILE has not changed. Skipping upload.";
        fi
